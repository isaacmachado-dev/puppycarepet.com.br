// Este é o seu arquivo de esquema Prisma.
// Saiba mais na documentação: https://pris.ly/d/prisma-schema

// Procurando maneiras de acelerar suas consultas ou escalar facilmente com suas funções serverless ou edge?

// Experimente o Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL") // Usar essa linha para gerar um cliente Prisma localmente
}

model ATENDIMENTOS {
  ID_ATENDIMENTO Int                   @id @default(autoincrement())
  ID_CLIENTE     Int
  CLIENTE        CLIENTES              @relation(fields: [ID_CLIENTE], references: [ID_CLIENTE])
  ID_PET         Int
  PET            PETS                  @relation(fields: [ID_PET], references: [ID_PET])
  ID_SERVICO     Int
  SERVICO        SERVICOS              @relation(fields: [ID_SERVICO], references: [ID_SERVICO])
  VALOR_COBRADO  Decimal
  TIPO           String                @db.VarChar(50)
  NOTAS          String?
  TELEFONE_DONO  String?               @db.VarChar(20)
  IDADE_PET      String?               @db.VarChar(20)
  PORTE_PET      String?               @db.VarChar(20)
  IMAGENS        ATENDIMENTO_IMAGENS[] // um atendimento pode ter várias imagens (back-relation para ATENDIMENTO_IMAGENS.ATENDIMENTO)
  // --- Campos de rastreamento com prioridade para uso offline ---
  PUBLIC_ID      String                @unique @default(uuid())
  CREATED_AT     DateTime              @default(now())
  UPDATED_AT     DateTime              @updatedAt
  DELETED_AT     DateTime?
  VERSION        Int                   @default(1)

  @@index([UPDATED_AT])
}

model ATENDIMENTO_IMAGENS {
  ID_IMAGEM      Int          @id @default(autoincrement())
  ID_ATENDIMENTO Int
  ATENDIMENTO    ATENDIMENTOS @relation(fields: [ID_ATENDIMENTO], references: [ID_ATENDIMENTO])
  CAMINHO_IMAGEM String       @db.VarChar(255)
  DATA_UPLOAD    DateTime     @default(now())
  // --- Campos de rastreamento com prioridade para uso offline ---
  PUBLIC_ID      String       @unique @default(uuid())
  CREATED_AT     DateTime     @default(now())
  UPDATED_AT     DateTime     @updatedAt
  DELETED_AT     DateTime?
  VERSION        Int          @default(1)

  @@index([UPDATED_AT])
}

model CLIENTES {
  ID_CLIENTE   Int            @id @default(autoincrement())
  NOME         String         @db.VarChar(100)
  TELEFONE     String         @db.VarChar(20)
  ENDERECO     String         @db.VarChar(255)
  FOTO_USUARIO Boolean        @default(false)
  // Mapeamento opcional para o usuário autenticado
  ID_USUARIO   Int?
  USUARIO      USUARIOS?      @relation(fields: [ID_USUARIO], references: [ID_USUARIO])
  PETS         PETS[] // um cliente pode ter vários pets (back-relation para PETS.CLIENTE)
  PACOTES      PACOTES[] // um cliente pode ter vários pacotes (back-relation para PACOTES.CLIENTE)
  ATENDIMENTOS ATENDIMENTOS[] // um cliente pode ter vários atendimentos (back-relation para ATENDIMENTOS.CLIENTE)
  // --- Campos de rastreamento com prioridade para uso offline ---
  PUBLIC_ID    String         @unique @default(uuid())
  CREATED_AT   DateTime       @default(now())
  UPDATED_AT   DateTime       @updatedAt
  DELETED_AT   DateTime?
  VERSION      Int            @default(1)

  @@index([UPDATED_AT])
  @@index([ID_USUARIO])
}

model PETS {
  ID_PET       Int            @id @default(autoincrement())
  NOME         String
  RACA         String?
  DATA_NASC    DateTime?
  ID_CLIENTE   Int
  CLIENTE      CLIENTES       @relation(fields: [ID_CLIENTE], references: [ID_CLIENTE])
  ATENDIMENTOS ATENDIMENTOS[]
  // --- Campos de rastreamento com prioridade para uso offline ---
  PUBLIC_ID    String         @unique @default(uuid())
  CREATED_AT   DateTime       @default(now())
  UPDATED_AT   DateTime       @updatedAt
  DELETED_AT   DateTime?
  VERSION      Int            @default(1)

  @@index([UPDATED_AT])
}

model PACOTES {
  ID_ASSINATURA Int       @id @default(autoincrement())
  ID_CLIENTE    Int
  CLIENTE       CLIENTES  @relation(fields: [ID_CLIENTE], references: [ID_CLIENTE])
  ID_SERVICO    Int
  SERVICO       SERVICOS  @relation(fields: [ID_SERVICO], references: [ID_SERVICO])
  QTD_BANHOS    Int       @default(0)
  // --- Campos de rastreamento com prioridade para uso offline ---
  PUBLIC_ID     String    @unique @default(uuid())
  CREATED_AT    DateTime  @default(now())
  UPDATED_AT    DateTime  @updatedAt
  DELETED_AT    DateTime?
  VERSION       Int       @default(1)

  @@index([UPDATED_AT])
}

model SERVICOS {
  ID_SERVICO   Int            @id @default(autoincrement())
  NOME         String         @db.VarChar(100)
  DESCRICAO    String?
  VALOR        Decimal
  ATENDIMENTOS ATENDIMENTOS[] // um serviço pode ter vários atendimentos (back-relation para ATENDIMENTOS.SERVICO)
  PACOTES      PACOTES[] // um serviço pode estar em vários pacotes (back-relation para PACOTES.SERVICO)
  // --- Campos de rastreamento com prioridade para uso offline ---
  PUBLIC_ID    String         @unique @default(uuid())
  CREATED_AT   DateTime       @default(now())
  UPDATED_AT   DateTime       @updatedAt
  DELETED_AT   DateTime?
  VERSION      Int            @default(1)

  @@index([UPDATED_AT])
}

model USUARIOS {
  ID_USUARIO   Int       @id @default(autoincrement())
  NOME         String    @db.VarChar(100)
  DESCRICAO    String?
  EMAIL        String    @unique @db.VarChar(150)
  TELEFONE     String?   @db.VarChar(20)
  FOTO         String? @db.VarChar(255)
  SENHA_HASH   String    @db.VarChar(255)
  TIPOS        String[]  @default([])
  CLIENTES     CLIENTES[]
  // --- Campos de rastreamento com prioridade para uso offline ---
  PUBLIC_ID    String    @unique @default(uuid())
  CREATED_AT   DateTime  @default(now())
  UPDATED_AT   DateTime  @updatedAt
  DELETED_AT   DateTime?
  VERSION      Int       @default(1)

  @@index([UPDATED_AT])
}
